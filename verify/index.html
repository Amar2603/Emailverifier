<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>E-fy Dashboard</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',sans-serif;}

body{
  background:#f5f7f8;
  height:100vh;
  overflow:hidden;
}

/* ===== Background Curve ===== */
.bg-shape{
  position:absolute;
  top:0;
  right:0;
  width:70%;
  height:60%;
  background:linear-gradient(135deg,#0d5964,#3bb6be);
  border-bottom-left-radius:200px;
  z-index:-1;
}

/* ===== Sidebar ===== */
.sidebar{
  width:260px;
  height:100vh;
  background:#fff;
  padding:30px;
  position:fixed;
}

.logo{
  font-size:32px;
  font-weight:700;
  color:#1c8b95;
  margin-bottom:60px;
}

.menu{
  display:flex;
  flex-direction:column;
  gap:25px;
}

.menu-item{
  padding:15px 20px;
  border-radius:12px;
  font-size:18px;
  cursor:pointer;
  color:#2c3e50;
}

.menu-item.active{
  background:#2aa7ad;
  color:white;
}

/* ===== Main Content ===== */
.main{
  margin-left:260px;
  padding:60px;
}

/* Card */
.card{
  background:#ffffff;
  border-radius:25px;
  padding:40px;
  box-shadow:0 20px 40px rgba(0,0,0,0.1);
}

/* Tabs */
.tabs{
  display:flex;
  justify-content:space-between;
  background:#ececec;
  padding:8px;
  border-radius:50px;
  margin-bottom:40px;
}

.tab{
  flex:1;
  text-align:center;
  padding:12px;
  border-radius:50px;
  cursor:pointer;
  font-weight:500;
  transition:0.3s;
}

.tab.active{
  background:#2aa7ad;
  color:white;
}

/* Sections */
.section{display:none;}
.section.active{display:block;}

/* Upload Box */
.upload-box{
  background:#efefef;
  border-radius:25px;
  padding:100px;
  text-align:center;
  color:#777;
  font-size:20px;
}

.upload-box button{
  margin-top:40px;
  padding:12px 40px;
  border-radius:12px;
  border:2px solid #2aa7ad;
  background:white;
  color:#2aa7ad;
  font-size:18px;
  cursor:pointer;
}

input, textarea{
  width:100%;
  padding:15px;
  border-radius:15px;
  border:1px solid #ccc;
  margin-top:20px;
  font-size:16px;
}

.verify-btn{
  margin-top:20px;
  padding:12px 30px;
  border:none;
  border-radius:12px;
  background:#2aa7ad;
  color:white;
  font-size:16px;
  cursor:pointer;
}

.result{
  margin-top:25px;
  padding:15px;
  border-radius:12px;
  background:#f4f6f8;
}

.result-table{
  margin-top:25px;
  width:100%;
  border-collapse:collapse;
}

.result-table th,.result-table td{
  padding:10px;
  text-align:left;
  border-bottom:1px solid #ddd;
}

.result-table th{
  background:#2aa7ad;
  color:white;
}

.result-table .valid{
  color:green;
}

.result-table .bounce{
  color:red;
}

.result-table .unknown{
  color:orange;
}
</style>
</head>

<body>

<div class="bg-shape"></div>

<!-- Sidebar -->
<div class="sidebar">
  <div class="logo">E-fy ✉</div>
  <div class="menu">
    <div class="menu-item active">Email Verification</div>
    <div class="menu-item">Credit Balance</div>
  </div>
</div>

<!-- Main -->
<div class="main">
  <div class="card">

    <!-- Tabs -->
    <div class="tabs">
      <div class="tab active" onclick="switchTab('single',this)">Single Email</div>
      <div class="tab" onclick="switchTab('list',this)">Paste Email List</div>
      <div class="tab" onclick="switchTab('file',this)">File Upload</div>
      <div class="tab" onclick="switchTab('integration',this)">Integration</div>
      <div class="tab" onclick="switchTab('api',this)">API</div>
    </div>

    <!-- Single -->
    <div id="single" class="section active">
      <h2>Single Email Verification</h2>
      <input type="email" id="singleEmail" placeholder="Enter email address">
      <button class="verify-btn" onclick="verifySingle()">Verify</button>
      <div id="singleResult" class="result"></div>
    </div>

    <!-- List -->
    <div id="list" class="section">
      <h2>Paste Email List</h2>
      <textarea id="listEmails" rows="6" placeholder="Enter emails separated by comma or new line"></textarea>
      <button class="verify-btn" onclick="verifyList()">Verify List</button>
      <div id="listResult" class="result"></div>
    </div>

    <!-- File Upload -->
    <div id="file" class="section">
      <div class="upload-box">
        Drop Your File Here <br><br>
        (.txt / .csv / .xlsx)
        <br>
        <button onclick="document.getElementById('fileInput').click()">Select File</button>
        <input type="file" id="fileInput" hidden onchange="verifyFile()">
      </div>
      <div id="fileResult" class="result"></div>
    </div>

    <!-- Integration -->
    <div id="integration" class="section">
      <h2>Integration</h2>
      <p>Connect using SMTP or API integration.</p>
    </div>

    <!-- API -->
    <div id="api" class="section">
      <h2>API</h2>
      <p>POST /verify-email</p>
    </div>

  </div>
</div>

<script>
function switchTab(id,el){
  document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  el.classList.add('active');
}

function validateEmail(email){
  return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
}

async function verifySingle(){
  let email=document.getElementById('singleEmail').value.trim();
  let result=document.getElementById('singleResult');
  
  if(!email){
    result.innerHTML="❌ Please enter an email address";
    return;
  }
  
  if(!validateEmail(email)){
    result.innerHTML="❌ Invalid Email Format";
    return;
  }
  
  result.innerHTML="⏳ Verifying...";
  
  try{
    const response=await fetch('http://localhost:8001/verify-email?email=' + encodeURIComponent(email));
    const data=await response.json();
    
    let statusIcon='';
    if(data.status==='Valid'){
      statusIcon='✅';
    }else if(data.status==='Valid (Syntax)'){
      statusIcon='✅';
    }else if(data.status==='Bounce' || data.status==='Invalid Domain' || data.status==='Invalid Format' || data.status==='Disposable'){
      statusIcon='❌';
    }else if(data.status==='Unknown'){
      statusIcon='❓';
    }else if(data.status==='Catch-All'){
      statusIcon='⚠️';
    }else{
      statusIcon='❓';
    }
    
    result.innerHTML=statusIcon + ' Status: ' + data.status + '<br>SMTP Code: ' + (data.smtp_code || 'N/A') + '<br>Message: ' + (data.message || '');
  }catch(error){
    // Try fallback to local verification
    tryLocalVerification(email, result);
  }
}

async function tryLocalVerification(email, result) {
  result.innerHTML = "⏳ Trying local verification...";
  
  // Since server is not running, show instructions
  result.innerHTML = "⚠️ Server not running.<br><br>" +
    "To use this tool, please:<br>" +
    "1. Open terminal/command prompt<br>" +
    "2. Navigate to the payment folder<br>" +
    "3. Run: <code>python verify/server.py</code><br>" +
    "4. Open <code>http://localhost:8000</code> in browser<br><br>" +
    "<em>Or use the CLI tool:</em><br>" +
    "<code>python verify/singleemail.py</code>";
}

async function verifyList(){
  let emailsText=document.getElementById('listEmails').value;
  let emails=emailsText.split(/[\n,]+/).map(e=>e.trim()).filter(e=>e);
  let resultDiv=document.getElementById('listResult');
  
  if(emails.length===0){
    resultDiv.innerHTML="❌ Please enter at least one email";
    return;
  }
  
  // Validate format first
  let validFormat=emails.filter(validateEmail).length;
  if(validFormat===0){
    resultDiv.innerHTML="❌ No valid email formats found";
    return;
  }
  
  resultDiv.innerHTML="⏳ Verifying " + emails.length + " emails...";
  
  try{
    const response=await fetch('http://localhost:8001/verify-list?emails=' + encodeURIComponent(emails.join(',')));
    const data=await response.json();
    
    if(data.error){
      resultDiv.innerHTML="❌ Error: " + data.error;
      return;
    }
    
    // Build results table
    let valid=0,bounce=0,unknown=0;
    let tableHtml='<table class="result-table"><tr><th>Email</th><th>Status</th><th>Message</th></tr>';
    
    for(let r of data.results){
      let statusClass='';
      if(r.status==='Valid'){
        valid++;
        statusClass='valid';
      }else if(r.status==='Bounce' || r.status==='Invalid Domain' || r.status==='Invalid Format'){
        bounce++;
        statusClass='bounce';
      }else{
        unknown++;
        statusClass='unknown';
      }
      
      tableHtml+='<tr><td>'+r.email+'</td><td class="'+statusClass+'">'+r.status+'</td><td>'+r.message+'</td></tr>';
    }
    
    tableHtml+='</table>';
    tableHtml+='<br><strong>Summary:</strong> Valid: '+valid+', Bounce: '+bounce+', Unknown: '+unknown;
    
    resultDiv.innerHTML=tableHtml;
  }catch(error){
    resultDiv.innerHTML="❌ Error: Cannot connect to server. Make sure to run 'python server.py' first, then open http://localhost:8000 in your browser (not the HTML file directly)";
  }
}

async function verifyFile(){
  let file=document.getElementById('fileInput').files[0];
  let resultDiv=document.getElementById('fileResult');
  
  if(!file){
    resultDiv.innerHTML="❌ Please select a file";
    return;
  }
  
  resultDiv.innerHTML="⏳ Uploading and processing file...";
  
  try{
    let formData=new FormData();
    formData.append('file', file);
    
    const response=await fetch('http://localhost:8001/upload-file', {
      method:'POST',
      body:formData
    });
    
    const data=await response.json();
    
    if(data.error){
      resultDiv.innerHTML="❌ Error: " + data.error;
      return;
    }
    
    // Build results table
    let valid=0,bounce=0,unknown=0,catchAll=0,risky=0;
    let tableHtml='<table class="result-table"><tr><th>Email</th><th>Status</th><th>Message</th></tr>';
    
    for(let r of data.results){
      let statusClass='';
      if(r.status==='Valid'){
        valid++;
        statusClass='valid';
      }else if(r.status==='Bounce' || r.status==='Invalid Domain' || r.status==='Invalid Format' || r.status==='Disposable'){
        bounce++;
        statusClass='bounce';
      }else if(r.status==='Catch-All'){
        catchAll++;
        statusClass='unknown';
      }else if(r.status==='Risky'){
        risky++;
        statusClass='unknown';
      }else{
        unknown++;
        statusClass='unknown';
      }
      
      tableHtml+='<tr><td>'+r.email+'</td><td class="'+statusClass+'">'+r.status+'</td><td>'+r.message+'</td></tr>';
    }
    
    tableHtml+='</table>';
    tableHtml+='<br><strong>Summary:</strong> Valid: '+valid+', Bounce: '+bounce+', Catch-All: '+catchAll+', Risky: '+risky+', Unknown: '+unknown;
    tableHtml+='<br><strong>Total Processed:</strong> '+data.total;
    
    resultDiv.innerHTML=tableHtml;
  }catch(error){
    resultDiv.innerHTML="❌ Error: Cannot connect to server. Make sure to run 'python server.py' first, then open http://localhost:8000 in your browser (not the HTML file directly)";
  }
}
</script>

</body>
</html>
